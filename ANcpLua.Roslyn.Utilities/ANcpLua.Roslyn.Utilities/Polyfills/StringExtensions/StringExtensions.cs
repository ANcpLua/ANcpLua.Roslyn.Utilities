// <auto-generated />
#nullable enable

#if !NETCOREAPP2_1_OR_GREATER && !NETSTANDARD2_1_OR_GREATER

namespace System;

using System.CodeDom.Compiler;
using System.Diagnostics.CodeAnalysis;
using System.Text;

/// <summary>
/// Provides extension methods for <see cref="string"/> that are missing in older target frameworks.
/// These methods enable CA1307 and CA2249 compliance on netstandard2.0.
/// </summary>
[GeneratedCode("ANcpLua.Roslyn.Utilities", "1.0.0")]
[ExcludeFromCodeCoverage]
internal static class StringExtensionsPolyfill
{
    /// <summary>
    /// Returns a value indicating whether a specified substring occurs within this string,
    /// using the specified comparison rules.
    /// </summary>
    public static bool Contains(this string source, string value, StringComparison comparisonType)
    {
        if (source is null)
        {
            throw new ArgumentNullException(nameof(source));
        }

        if (value is null)
        {
            throw new ArgumentNullException(nameof(value));
        }

        return source.IndexOf(value, comparisonType) >= 0;
    }

    /// <summary>
    /// Returns a value indicating whether a specified character occurs within this string.
    /// </summary>
    public static bool Contains(this string source, char value)
    {
        if (source is null)
        {
            throw new ArgumentNullException(nameof(source));
        }

        return source.IndexOf(value) >= 0;
    }

    /// <summary>
    /// Returns a value indicating whether a specified character occurs within this string,
    /// using the specified comparison rules.
    /// </summary>
    public static bool Contains(this string source, char value, StringComparison comparisonType)
    {
        if (source is null)
        {
            throw new ArgumentNullException(nameof(source));
        }

        return source.IndexOf(value.ToString(), comparisonType) >= 0;
    }

    /// <summary>
    /// Returns a new string in which all occurrences of a specified string in the current instance
    /// are replaced with another specified string, using the specified comparison type.
    /// </summary>
    public static string Replace(this string source, string oldValue, string? newValue, StringComparison comparisonType)
    {
        if (source is null)
        {
            throw new ArgumentNullException(nameof(source));
        }

        if (oldValue is null)
        {
            throw new ArgumentNullException(nameof(oldValue));
        }

        if (oldValue.Length is 0)
        {
            throw new ArgumentException("String cannot be of zero length.", nameof(oldValue));
        }

        if (comparisonType is StringComparison.Ordinal)
        {
            return source.Replace(oldValue, newValue);
        }

        var result = new StringBuilder(source.Length);
        var searchIndex = 0;

        while (searchIndex < source.Length)
        {
            var matchIndex = source.IndexOf(oldValue, searchIndex, comparisonType);

            if (matchIndex < 0)
            {
                result.Append(source, searchIndex, source.Length - searchIndex);
                break;
            }

            if (matchIndex > searchIndex)
            {
                result.Append(source, searchIndex, matchIndex - searchIndex);
            }

            if (newValue is not null)
            {
                result.Append(newValue);
            }

            searchIndex = matchIndex + oldValue.Length;
        }

        return result.ToString();
    }

    /// <summary>
    /// Reports the zero-based index of the first occurrence of the specified character in this instance,
    /// using the specified comparison rules.
    /// </summary>
    public static int IndexOf(this string source, char value, StringComparison comparisonType)
    {
        if (source is null)
        {
            throw new ArgumentNullException(nameof(source));
        }

        return source.IndexOf(value.ToString(), comparisonType);
    }
}

#endif
