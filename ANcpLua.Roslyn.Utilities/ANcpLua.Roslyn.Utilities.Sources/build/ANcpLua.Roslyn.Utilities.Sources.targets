<!--
  ANcpLua.Roslyn.Utilities.Sources.targets - Polyfill injection control

  All polyfill source files are included via NuGet contentFiles with BuildAction=Compile.
  Each file has #if guards that gate compilation based on target framework.

  Use the InjectXxx properties below to OPT OUT of specific polyfills when they
  conflict with other polyfill sources (e.g., PolySharp, Microsoft.Extensions.Polyfills).

  USAGE: Set any property to 'false' in your project to exclude that polyfill:
    <InjectTrimAttributesOnLegacy>false</InjectTrimAttributesOnLegacy>

  Or disable ALL polyfills (keeps only Roslyn utilities):
    <InjectAllPolyfillsOnLegacy>false</InjectAllPolyfillsOnLegacy>
-->
<Project>

  <!-- ═══════════════════════════════════════════════════════════════════════
       GENERATED CODE MARKER
       The Transform-Sources.ps1 script prepends // <auto-generated/> to each
       file, which the Roslyn compiler and all well-behaved analyzers honor as
       generated_code = true.  No additional editorconfig is needed.
       ═══════════════════════════════════════════════════════════════════════ -->

  <!-- ═══════════════════════════════════════════════════════════════════════
       DEFAULT VALUES - All polyfills enabled by default (self-gate via #if)
       ═══════════════════════════════════════════════════════════════════════ -->
  <PropertyGroup>
    <InjectAllPolyfillsOnLegacy Condition="'$(InjectAllPolyfillsOnLegacy)' == ''">true</InjectAllPolyfillsOnLegacy>
  </PropertyGroup>

  <!-- Individual polyfill defaults (follow the bundle unless explicitly overridden) -->
  <PropertyGroup>
    <InjectTrimAttributesOnLegacy Condition="'$(InjectTrimAttributesOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectTrimAttributesOnLegacy>
    <InjectNullabilityAttributesOnLegacy Condition="'$(InjectNullabilityAttributesOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectNullabilityAttributesOnLegacy>
    <InjectIsExternalInitOnLegacy Condition="'$(InjectIsExternalInitOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectIsExternalInitOnLegacy>
    <InjectRequiredMemberOnLegacy Condition="'$(InjectRequiredMemberOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectRequiredMemberOnLegacy>
    <InjectCallerAttributesOnLegacy Condition="'$(InjectCallerAttributesOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectCallerAttributesOnLegacy>
    <InjectCompilerFeatureRequiredOnLegacy Condition="'$(InjectCompilerFeatureRequiredOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectCompilerFeatureRequiredOnLegacy>
    <InjectSetsRequiredMembersOnLegacy Condition="'$(InjectSetsRequiredMembersOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectSetsRequiredMembersOnLegacy>
    <InjectParamCollectionOnLegacy Condition="'$(InjectParamCollectionOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectParamCollectionOnLegacy>
    <InjectUnreachableExceptionOnLegacy Condition="'$(InjectUnreachableExceptionOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectUnreachableExceptionOnLegacy>
    <InjectExperimentalAttributeOnLegacy Condition="'$(InjectExperimentalAttributeOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectExperimentalAttributeOnLegacy>
    <InjectIndexRangeOnLegacy Condition="'$(InjectIndexRangeOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectIndexRangeOnLegacy>
    <InjectStackTraceHiddenOnLegacy Condition="'$(InjectStackTraceHiddenOnLegacy)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectStackTraceHiddenOnLegacy>
    <InjectLockPolyfill Condition="'$(InjectLockPolyfill)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectLockPolyfill>
    <InjectTimeProviderPolyfill Condition="'$(InjectTimeProviderPolyfill)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectTimeProviderPolyfill>
    <InjectStringExtensionsPolyfill Condition="'$(InjectStringExtensionsPolyfill)' == ''">$(InjectAllPolyfillsOnLegacy)</InjectStringExtensionsPolyfill>
  </PropertyGroup>

  <!-- ═══════════════════════════════════════════════════════════════════════
       CONDITIONAL EXCLUSION
       Remove polyfill contentFiles from Compile when opted out.
       Files self-gate via #if guards, so exclusion is only needed to
       avoid duplicate type definitions from other polyfill sources.
       ═══════════════════════════════════════════════════════════════════════ -->

  <!-- Trim Attributes -->
  <ItemGroup Condition="'$(InjectTrimAttributesOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('Polyfills/TrimAttributes/'))" />
  </ItemGroup>

  <!-- Nullable Attributes (DiagnosticAttributes + NullabilityAttributes) -->
  <ItemGroup Condition="'$(InjectNullabilityAttributesOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('Polyfills/DiagnosticAttributes/'))" />
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('Polyfills/NullabilityAttributes/'))" />
  </ItemGroup>

  <!-- Language Features (individual control) -->
  <ItemGroup Condition="'$(InjectIsExternalInitOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('IsExternalInit.cs'))" />
  </ItemGroup>

  <ItemGroup Condition="'$(InjectRequiredMemberOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('RequiredMemberAttribute.cs'))" />
  </ItemGroup>

  <ItemGroup Condition="'$(InjectCallerAttributesOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('CallerArgumentExpressionAttribute.cs'))" />
  </ItemGroup>

  <ItemGroup Condition="'$(InjectCompilerFeatureRequiredOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('CompilerFeatureRequiredAttribute.cs'))" />
  </ItemGroup>

  <ItemGroup Condition="'$(InjectSetsRequiredMembersOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('SetsRequiredMembersAttribute.cs'))" />
  </ItemGroup>

  <ItemGroup Condition="'$(InjectParamCollectionOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('ParamCollectionAttribute.cs'))" />
  </ItemGroup>

  <!-- Diagnostics -->
  <ItemGroup Condition="'$(InjectStackTraceHiddenOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('Polyfills/Diagnostics/'))" />
  </ItemGroup>

  <!-- Exceptions -->
  <ItemGroup Condition="'$(InjectUnreachableExceptionOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('Polyfills/Exceptions/'))" />
  </ItemGroup>

  <!-- Experimental -->
  <ItemGroup Condition="'$(InjectExperimentalAttributeOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('Polyfills/Experimental/'))" />
  </ItemGroup>

  <!-- Index/Range -->
  <ItemGroup Condition="'$(InjectIndexRangeOnLegacy)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('Polyfills/IndexRange/'))" />
  </ItemGroup>

  <!-- Lock -->
  <ItemGroup Condition="'$(InjectLockPolyfill)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('Polyfills/Lock.cs'))" />
  </ItemGroup>

  <!-- TimeProvider -->
  <ItemGroup Condition="'$(InjectTimeProviderPolyfill)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('Polyfills/TimeProvider/'))" />
  </ItemGroup>

  <!-- String Extensions -->
  <ItemGroup Condition="'$(InjectStringExtensionsPolyfill)' == 'false'">
    <Compile Remove="@(Compile)" Condition="$([System.String]::new('%(Identity)').Contains('Polyfills/StringExtensions/'))" />
  </ItemGroup>

</Project>
